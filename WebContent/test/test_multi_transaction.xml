<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="555" Id="form" Left="8" OnLoadCompleted="form_OnLoadCompleted" PidAttrib="7" Title="New&#32;Form" ToolTipFont="Default,0" Top="8" Ver="1.0" Width="790" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_big_menu">
				<Contents>
					<colinfo id="id" size="256" summ="default" type="STRING"/>
					<colinfo id="levels" size="256" summ="default" type="STRING"/>
					<colinfo id="section" size="256" summ="default" type="STRING"/>
					<colinfo id="lvl_seq" size="256" summ="default" type="STRING"/>
					<colinfo id="menu_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="page_url" size="256" summ="default" type="STRING"/>
					<colinfo id="etc" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_small_menu">
				<Contents>
					<colinfo id="id" size="256" summ="default" type="STRING"/>
					<colinfo id="levels" size="256" summ="default" type="STRING"/>
					<colinfo id="section" size="256" summ="default" type="STRING"/>
					<colinfo id="lvl_seq" size="256" summ="default" type="STRING"/>
					<colinfo id="menu_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="page_url" size="256" summ="default" type="STRING"/>
					<colinfo id="etc" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_test_data">
				<Contents>
					<colinfo id="id" size="256" summ="default" type="STRING"/>
					<colinfo id="levels" size="256" summ="default" type="STRING"/>
					<colinfo id="section" size="256" summ="default" type="STRING"/>
					<colinfo id="lvl_seq" size="256" summ="default" type="STRING"/>
					<colinfo id="menu_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="page_url" size="256" summ="default" type="STRING"/>
					<colinfo id="etc" size="256" summ="default" type="STRING"/>
					<colinfo id="index" size="256" summ="default" type="STRING"/>
					<colinfo id="checked" size="256" summ="default" type="STRING"/>
					<colinfo id="manager" size="256" summ="default" type="STRING"/>
					<colinfo id="join_date" size="256" summ="default" type="STRING"/>
					<colinfo id="dept_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="image_level" size="256" summ="default" type="STRING"/>
					<colinfo id="file_name" size="256" summ="default" type="STRING"/>
					<colinfo id="Flag" size="256" summ="default" type="STRING"/>
					<colinfo id="row_id" size="256" summ="default" type="STRING"/>
					<colinfo id="operator" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ins_test_data">
				<Contents>
					<colinfo id="id" size="256" summ="default" type="STRING"/>
					<colinfo id="levels" size="256" summ="default" type="STRING"/>
					<colinfo id="section" size="256" summ="default" type="STRING"/>
					<colinfo id="lvl_seq" size="256" summ="default" type="STRING"/>
					<colinfo id="menu_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="page_url" size="256" summ="default" type="STRING"/>
					<colinfo id="etc" size="256" summ="default" type="STRING"/>
					<colinfo id="index" size="256" summ="default" type="STRING"/>
					<colinfo id="checked" size="256" summ="default" type="STRING"/>
					<colinfo id="manager" size="256" summ="default" type="STRING"/>
					<colinfo id="join_date" size="256" summ="default" type="STRING"/>
					<colinfo id="dept_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="image_level" size="256" summ="default" type="STRING"/>
					<colinfo id="file_name" size="256" summ="default" type="STRING"/>
					<colinfo id="Flag" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsPopupMenu">
				<Contents>
					<colinfo id="LEVEL" size="2" type="INT"/>
					<colinfo id="ID" size="3" type="INT"/>
					<colinfo id="TEXT" size="256" type="STRING"/>
					<colinfo id="Status" size="256" type="STRING"/>
					<colinfo id="ImageID" size="256" type="STRING"/>
					<record>
						<ID>100</ID>
						<ImageID></ImageID>
						<LEVEL>1</LEVEL>
						<Status></Status>
						<TEXT>Muilt&#32;Sort</TEXT>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_tmp_test_data">
				<Contents>
					<colinfo id="id" size="256" summ="default" type="STRING"/>
					<colinfo id="levels" size="256" summ="default" type="STRING"/>
					<colinfo id="section" size="256" summ="default" type="STRING"/>
					<colinfo id="lvl_seq" size="256" summ="default" type="STRING"/>
					<colinfo id="menu_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="page_url" size="256" summ="default" type="STRING"/>
					<colinfo id="etc" size="256" summ="default" type="STRING"/>
					<colinfo id="index" size="256" summ="default" type="STRING"/>
					<colinfo id="checked" size="256" summ="default" type="STRING"/>
					<colinfo id="manager" size="256" summ="default" type="STRING"/>
					<colinfo id="join_date" size="256" summ="default" type="STRING"/>
					<colinfo id="dept_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="image_level" size="256" summ="default" type="STRING"/>
					<colinfo id="file_name" size="256" summ="default" type="STRING"/>
					<colinfo id="Flag" size="256" summ="default" type="STRING"/>
					<colinfo id="row_id" size="256" summ="default" type="STRING"/>
					<colinfo id="operator" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape BKColor="user21" Bottom="80" Height="40" Id="Shape5" Left="0" LineColor="user22" Right="790" RoundHeight="10" RoundUnit="Pixel" RoundWidth="10" TabOrder="20" Top="40" Type="RoundRect" Width="790"></Shape>
		<Image Align="Left" Height="18" Id="Image1" Left="20" LeftMargin="0" Style="Stc_Default_bold" TabOrder="1" Text="대메뉴" Top="50" Transparent="TRUE" Width="59"></Image>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="21" Id="btn_search" ImageID="Btn_com_search" Left="728" LeftMargin="16" OnClick="btn_search_OnClick" Style="Btn_sub" TabOrder="3" Top="48" TopMargin="1" Transparent="TRUE" Width="50"></Button>
		<Shape Bottom="89" Height="56" Id="Shape11" Left="0" LineColor="sienna" LineKind="Vertical" LineWidth="10" Right="20" TabOrder="2" Top="33" Type="Rectangle" Visible="FALSE" Width="20"></Shape>
		<Shape Bottom="75" Height="32" Id="Shape12" Left="60" LineColor="sienna" LineKind="Vertical" LineWidth="10" Right="70" TabOrder="4" Top="43" Type="Rectangle" Visible="FALSE" Width="10"></Shape>
		<Combo Border="Flat" DataColumn="menu_nm" Height="18" Id="cob_big_menu" ImeMode="none" InnerDataset="ds_big_menu" Left="69" OnChanged="cob_big_menu_OnChanged" OnKeyDown="cob_big_menu_OnKeyDown" Style="Combo" TabOrder="5" Top="49" Width="160"></Combo>
		<Static Height="20" Id="Static8" Style="Stc_Title" TabOrder="6" Text="Test&#32;Multi&#32;Transaction" Width="304"></Static>
		<Shape Bottom="40" Height="7" Id="Shape13" Left="0" LineColor="seagreen" LineKind="Vertical" LineWidth="2" Right="790" TabOrder="7" Top="33" Type="Rectangle" Visible="FALSE" Width="790"></Shape>
		<Image Align="Left" Height="18" Id="Image0" Left="252" LeftMargin="0" Style="Stc_Default_bold" TabOrder="8" Text="소메뉴" Top="50" Transparent="TRUE" Width="59"></Image>
		<Shape Bottom="75" Height="32" Id="Shape1" Left="292" LineColor="sienna" LineKind="Vertical" LineWidth="10" Right="302" TabOrder="9" Top="43" Type="Rectangle" Visible="FALSE" Width="10"></Shape>
		<Combo Border="Flat" DataColumn="menu_nm" Editable="TRUE" Height="18" Id="cob_small_menu" InnerDataset="ds_small_menu" Left="301" OnChanged="cob_small_menu_OnChanged" OnKeyDown="cob_small_menu_OnKeyDown" Style="Combo" TabOrder="10" Top="49" Width="160"></Combo>
		<Image Align="Left" Height="14" Id="Image2" ImageID="Title_dot" LeftMargin="20" Style="Stc_Subtitle" TabOrder="11" Text="테스트&#32;조회" Top="102" Transparent="TRUE" Width="157"></Image>
		<Shape Bottom="121" Height="5" Id="Shape20" Left="-8" LineColor="seagreen" LineKind="Vertical" LineWidth="5" Right="802" TabOrder="12" Top="116" Type="Rectangle" Visible="FALSE" Width="810"></Shape>
		<Button ButtonStyle="TRUE" Height="21" Id="btn_del_row" ImageID="Btn_sub_rowdel" Left="529" OnClick="btn_del_row_OnClick" Style="Btn_sub" TabOrder="14" Text="&#32;&#32;&#32;행삭제" Top="95" Width="61"></Button>
		<Shape Bottom="121" Height="32" Id="Shape19" Left="524" LineColor="tomato" LineKind="Vertical" LineWidth="4" Right="529" TabOrder="15" Top="89" Type="Rectangle" Visible="FALSE" Width="5"></Shape>
		<Button ButtonStyle="TRUE" Height="21" Id="btn_add_row" ImageID="Btn_sub_rowadd" Left="463" OnClick="btn_add_row_OnClick" Style="Btn_sub" TabOrder="13" Text="&#32;&#32;&#32;행추가" Top="95" Width="61"></Button>
		<Shape Bottom="95" Height="15" Id="Shape2" Left="0" LineColor="seagreen" LineKind="Vertical" LineWidth="10" Right="794" TabOrder="16" Top="80" Type="Rectangle" Visible="FALSE" Width="794"></Shape>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="21" Id="btn_save" ImageID="Btn_com_2w" Left="738" LeftMargin="12" OnClick="save_values" Style="Btn_Com" TabOrder="17" Text="저장" Top="12" TopMargin="1" Transparent="TRUE" Width="50"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="21" Id="Button35" ImageID="Btn_sub_ex_down" Left="595" LeftMargin="16" OnClick="btn_print_OnClick" Style="Btn_sub" TabOrder="18" Top="95" TopMargin="1" Transparent="TRUE" Width="99"></Button>
		<FileDialog Bottom="118" Filter="All(*.*)|*.*|" Height="24" Id="FileDialog0" Left="816" Right="840" TabOrder="24" Top="94" Type="Save" Width="24"></FileDialog>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="21" Id="Button5" ImageID="Btn_com_3w" Left="671" LeftMargin="12" OnClick="Button5_OnClick" Style="Btn_Com" TabOrder="21" Text="초기화" Top="12" Transparent="TRUE" Width="62"></Button>
		<Shape Bottom="39" Height="32" Id="Shape0" Left="733" LineColor="tomato" LineKind="Vertical" LineWidth="4" Right="738" TabOrder="22" Top="7" Type="Rectangle" Visible="FALSE" Width="5"></Shape>
		<Shape Bottom="121" Height="32" Id="Shape4" Left="590" LineColor="tomato" LineKind="Vertical" LineWidth="4" Right="595" TabOrder="19" Top="89" Type="Rectangle" Visible="FALSE" Width="5"></Shape>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="21" Id="Button29" ImageID="Btn_sub_ex_upload" Left="697" LeftMargin="16" OnClick="Button29_OnClick" Style="Btn_sub" TabOrder="23" Top="95" TopMargin="1" Transparent="TRUE" Width="92"></Button>
		<Shape Bottom="121" Height="32" Id="Shape3" Left="693" LineColor="tomato" LineKind="Vertical" LineWidth="4" Right="698" TabOrder="24" Top="89" Type="Rectangle" Visible="FALSE" Width="5"></Shape>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_test_data" BkColor2="user55" BkSelColor="user54" BoldHead="FALSE" Border="Flat" Bottom="553" CellMoving="TRUE" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" HeadBorder="Flat" HeadHeight="24" Height="432" Id="Grid1" InputPanel="FALSE" Left="-1" LineColor="default" LineType="OnlyVERT" MinWidth="100" OnRButtonDown="Grid1_OnRButtonDown" Right="789" RowHeight="20" Style="Grid_2" TabOrder="25" TabStop="true" Top="121" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="790">
			<contents>
				<format id="Default">
					<columns>
						<col width="0"/>
						<col width="0"/>
						<col width="0"/>
						<col width="30"/>
						<col width="38"/>
						<col width="52"/>
						<col width="69"/>
						<col width="63"/>
						<col width="212"/>
						<col width="81"/>
						<col width="148"/>
						<col width="93"/>
					</columns>
					<head>
						<cell bkcolor="user51" bkimagealign="stretch" bkimageid="grid_t_bg" col="0" color="user52" display="text" text="flag"/>
						<cell bkcolor="user51" bkimagealign="stretch" bkimageid="grid_t_bg" col="1" color="user52" display="text" text="row_id"/>
						<cell bkcolor="user51" bkimagealign="stretch" bkimageid="grid_t_bg" col="2" color="user52" display="text" text="operator"/>
						<cell bkcolor="user51" bkimagealign="stretch" bkimageid="grid_t_bg" col="3" color="user52" display="checkbox" edit="checkbox"/>
						<cell bkcolor="user51" bkimagealign="stretch" bkimageid="grid_t_bg" col="4" color="user52" combocol="code" combodataset="ds_INDS_GB" combotext="value" display="text" text="NO"/>
						<cell bkcolor="user51" bkimagealign="stretch" bkimageid="grid_t_bg" col="5" color="user52" display="text" text="LEVELS"/>
						<cell bkcolor="user51" bkimagealign="stretch" bkimageid="grid_t_bg" col="6" color="user52" display="text" text="SECTION"/>
						<cell bkcolor="user51" bkimagealign="stretch" bkimageid="grid_t_bg" col="7" color="user52" display="text" text="LVL_SEQ"/>
						<cell bkcolor="user51" bkimagealign="stretch" bkimageid="grid_t_bg" col="8" color="user52" display="text" text="메뉴명"/>
						<cell bkcolor="user51" bkimagealign="stretch" bkimageid="grid_t_bg" col="9" color="user52" display="text" text="관리자"/>
						<cell bkcolor="user51" bkimagealign="stretch" bkimageid="grid_t_bg" col="10" color="user52" display="text" text="부서"/>
						<cell bkcolor="user51" bkimagealign="stretch" bkimageid="grid_t_bg" col="11" color="user52" display="text" text="입사일"/>
					</head>
					<body>
						<cell col="0" colid="flag" display="text" edit="normal"/>
						<cell col="1" colid="row_id" display="text" edit="normal" expandsize="0"/>
						<cell col="2" colid="operator" display="text"/>
						<cell align="center" col="3" colid="chk" color="black" display="checkbox" edit="checkbox"/>
						<cell align="center" col="4" colid="save_date" display="text" expr="row+1"/>
						<cell align="center" col="5" colid="levels" display="text" edit="normal"/>
						<cell align="center" col="6" colid="section" display="text" edit="normal"/>
						<cell align="center" col="7" colid="lvl_seq" combodisplaynltext="true" display="combo" edit="normal"/>
						<cell align="left" col="8" colid="dept_nm" combodisplaynltext="true" display="text" edit="normal"/>
						<cell align="center" col="9" colid="manager" combodisplaynltext="true" display="text" edit="normal"/>
						<cell align="center" col="10" colid="dept_nm" combodisplaynltext="true" display="text" edit="normal"/>
						<cell align="center" col="11" colid="join_date" color="black" display="text" edit="normal"/>
					</body>
				</format>
			</contents>
		</Grid>
	</Form>
	<Script><![CDATA[#include "lib::lib_global.js";
#include "lib::lib_comm.js";
#include "lib::lib_grid.js";
#include "lib::lib_platform.js";
#include "lib::lib_popup.js";
#include "lib::lib_msg.js";
#include "lib::lib_ext.js";

var big_section = ''; // 대메뉴를 구분하기 위한 전역변수
var small_seq   = ''; // 소메뉴를 구분하기 위한 전역변수
var checked_cnt = 0;  // 체크된 리스트의 수를 위한 전역변수


/* 폼 로드 함수 */
function form_OnLoadCompleted(obj)
{
	// 화면이 로드될 때 대메뉴를 조회한다.
	getBigMenuName();
}


/* 대메뉴 조회 */
function getBigMenuName()
{
	var svcID			= "TST001V.bigMenuNameSearch";
	var url   			= "service::TST001V.bigMenuNameSearch.do";
	var inDatasets  	= "";
	var outDatasets 	= "ds_big_menu=TST001V.selectBigMenuName";
	var argument    	= " _sqlName=TST001V.selectBigMenuName"
						;
	var callbackFunc 	= "fn_get_big_menu_callback";

	transaction(svcID, url, inDatasets, outDatasets, argument, callbackFunc);	
}


/* 대메뉴 조회 콜백 함수 - 콤보의 첫번째 값으로 [전체]를 넣어준다.*/
function fn_get_big_menu_callback()
{
	gfn_AddComboData(0, ds_big_menu, "id", "0", "menu_nm", "[전체]");
	cob_big_menu.Index  = 0;
	ds_small_menu.ClearData();
	gfn_AddComboData(0, ds_small_menu, "id", "0", "menu_nm", "[전체]");
	cob_small_menu.Index = 0;
}


/* 소메뉴 조회 */
function cob_big_menu_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	if(nNewIndex == 0){ // 대매뉴에서 [전체]를 선택한 경우
		ds_small_menu.ClearData();
		
		gfn_AddComboData(0, ds_small_menu, "id", "0", "menu_nm", "[전체]");
		cob_small_menu.Index = 0;

		big_section = '';
		small_seq   = '';
		return;
	}

	big_section = ds_big_menu.GetColumn(nNewIndex,'section');

	var svcID			= "TST001V.smallMenuNameSearch";
	var url   			= "service::TST001V.smallMenuNameSearch.do";
	var inDatasets  	= "";
	var outDatasets 	= "ds_small_menu=TST001V.selectSmallMenuName";
	var argument    	= " _sqlName=TST001V.selectSmallMenuName"
						+ " p_section=" + quote(big_section)				
						;
	var callbackFunc 	= "fn_cob_big_menu_callback";

	transaction(svcID, url, inDatasets, outDatasets, argument, callbackFunc);
}


/* 소메뉴 조회 콜백 함수 - 콤보의 첫번째 값으로 [전체]를 넣어준다.*/
function fn_cob_big_menu_callback()
{
	small_seq = '';
	gfn_AddComboData(0, ds_small_menu, "id", "0", "menu_nm", "[전체]");
	cob_small_menu.Index = 0;
}


/* 소매뉴 콤보를 선택하였을때 조회를 위해서 small_seq 변수에 LVL_SEQ 컬럼값을 넣어준다. */
function cob_small_menu_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	small_seq = ds_small_menu.GetColumn(nNewIndex,'LVL_SEQ');
}


/* 조회버튼 - 조회한다. */
function btn_search_OnClick(obj)
{
	Grid1.SetCellProp("head", 0, "Text", 0); //저장하면 자동조회를 하므로 헤더의 체크박스를 해제한다.
	
	gfn_clearHeader(Grid1); // 정렬시에 생긴 삼각형 모양 삭제

	var svcID			= "TST001V.testFunctionSearch";
	var url   			= "service::TST001V.testFunctionSearch.do";
	var inDatasets  	= "";
	var outDatasets 	= "ds_test_data=TST001V.selectTestTable";
	var argument    	= " _sqlName=TST001V.selectTestTable"
						+ " p_section=" + quote(big_section)
						+ " p_lvl_seq=" + quote(small_seq)
						;
	var callbackFunc 	= "fn_btn_search_OnClick_callback";

	transaction(svcID, url, inDatasets, outDatasets, argument, callbackFunc);
}

	
function fn_btn_search_OnClick_callback(svcId, errorCode, errorMsg)
{
	//alert(svcId+', '+errorCode+', '+errorMsg);
	if(errorMsg != ""){
		gfn_error_message(errorMsg);
	}
}


/* 그리드 리스트에서 체크박스를 선택한 것을 수정하거나 행추가 한 값을 디비에 추가하는 경우 */
function btn_save_OnClick(obj)
{
	if(ds_test_data.rowcount == 0){
		alert('먼저 리스트를 조회하세요.');
		return;
	}
	
	// 리스트에서 체크박스를 선택한 값이 몇개 인지 센다.
	for(var i=0; i<ds_test_data.rowcount; i++)
	{
		if(ds_test_data.GetColumn(i,"checked") == 1){
			checked_cnt++;
		}
	}
	
	Grid1.SetCellProp("head", 0, "Text", 0); //저장하면 자동조회를 하므로 헤더의 체크박스를 해제한다.
	
	if(checked_cnt == 0){
		alert('체크된 리스트가 없습니다.');
	}else{
		checkSaveData(checked_cnt);
		checked_cnt = 0;
	}
}

function save_values(obj)
{
	gfn_clearHeader(Grid1);

	//update, insert 발생- 트랜젝션 처리 
	if(ds_test_data.GetUpdate()==true){
		
			var svcID		= "TST001V.testMultiTransaction";              
			var url   		= "service::TST001V.testMultiTransaction.do";   
			var inDatasets  = "TST001V.saveMultiValues=ds_test_data:U";   //U: 데이터셋의 업데이트 된 row만 넘긴다, A:전부 전달, N:delete를 제외한 모든 정보전달                                      
			var outDatasets = "";
			var argument    = " _sqlName=TST001V.saveMultiValues"
							;
			var callbackFunc = "fn_save_callback"; 
		
			if (confirm("저장 하시겠습니까?")) {	
				transaction(svcID, url, inDatasets, outDatasets, argument, callbackFunc);		//gfn_transaction 사용
			}
	
	//delete, update, insert 없음
	}else{
		alert("저장할 내용이 없습니다.");
		//update, insert 발생, Null 값 있는 경우 메세지 처리
	}
}


/* 체크된 리스트의 수를 알아내어서 수정한다. */
function checkSaveData(cnt)
{
	// 체크된 값의 리스트를 저장하거나 수정할 때 
	// 처음인지 마지막인지를 알기 위해서 아래 checkedCnt 변수를 사용한다
	var checkedCnt = cnt; 
	
	for(var i=0; i<ds_test_data.rowcount; i++)
	{
	
		if(ds_test_data.GetColumn(i,"checked") == 1){

			//  한건만 체크 된 경우로 처음이자 마지막이다.
			if(cnt == 1){
				
				gfn_showProgressWindow(true);
				saveTestData(i, 'last');
				
			}
			// 여러 건을 선택한 경우
			else{
				
				// 처음
				if(checkedCnt == cnt){
					
					gfn_showProgressWindow(true); //처음이므로 진행상태바를 표시한다.
					saveTestData(i, 'first');
					
				// 마지막									
				}else if(checkedCnt == 1){
					
					saveTestData(i, 'last');
					
				// 중간
				}else{
					
					saveTestData(i, 'middle');
					
				}
				
			}			
			checkedCnt--; // 한건 처리했으므로 빼준다.
		}
	}
}


/* 값을 추가하거나 수정하는 함수 */
function saveTestData(rowIndex,flag)
{
	var id   	 = ds_test_data.GetColumn(rowIndex,"id");
	var levels   = ds_test_data.GetColumn(rowIndex,"levels");
	var section  = ds_test_data.GetColumn(rowIndex,"section");
	var lvl_seq  = ds_test_data.GetColumn(rowIndex,"lvl_seq");
	var menu_nm  = ds_test_data.GetColumn(rowIndex,"menu_nm");
	var page_url = ds_test_data.GetColumn(rowIndex,"page_url");
	var etc         = ds_test_data.GetColumn(rowIndex,"etc");
	var manager     = ds_test_data.GetColumn(rowIndex,"manager");
	var join_date   = ds_test_data.GetColumn(rowIndex,"join_date");
	var dept_nm     = ds_test_data.GetColumn(rowIndex,"dept_nm");	
	var image_level = ds_test_data.GetColumn(rowIndex,"image_level");
	var file_name   = ds_test_data.GetColumn(rowIndex,"file_name");
	
	
	ds_ins_test_data.ClearData();
	ds_ins_test_data.SetColumn(0, "levels", levels);
	ds_ins_test_data.SetColumn(0, "section", section);
	ds_ins_test_data.SetColumn(0, "lvl_seq", lvl_seq);
	ds_ins_test_data.SetColumn(0, "menu_nm", menu_nm);
	ds_ins_test_data.SetColumn(0, "page_url", page_url);
	ds_ins_test_data.SetColumn(0, "etc", etc);
	ds_ins_test_data.SetColumn(0, "manager", manager);
	ds_ins_test_data.SetColumn(0, "join_date", join_date);
	ds_ins_test_data.SetColumn(0, "dept_nm", dept_nm);
	ds_ins_test_data.SetColumn(0, "image_level", image_level);
	ds_ins_test_data.SetColumn(0, "file_name", file_name);
	
	alert('saveTestData');

	if(levels == null){
		alert('levels 값은 필수사항입니다!');
		return;
	}
	if(section == null){
		alert('section 값은 필수사항입니다!');
		return;
	}
	if(lvl_seq == null){
		alert('lvl_seq 값은 필수사항입니다!');
		return;
	}
	if(menu_nm == null){  // null 일 경우에는 SQL 에러가 생기므로 값을 일부러 넣어준다.
		menu_nm = ' ';
	}
	if(page_url == null){ // null 일 경우에는 SQL 에러가 생기므로 값을 일부러 넣어준다.
		page_url = ' ';
	}
	if(etc == null){      // null 일 경우에는 SQL 에러가 생기므로 값을 일부러 넣어준다.
		etc = ' ';
	}
	
	var svcID			= "TST001V.testFunctionSave";
	var url   			= "service::TST001V.testFunctionSave.do";
	//var inDatasets      = "TST001V.insertTestTableData2=ds_ins_test_data";
	var inDatasets      = "";
	var outDatasets 	= "";
	var argument        = "";
	
	// 추가 (Insert)
	if(id == null){
		
		argument    	= " _sqlName=TST001V.insertTestTableData"
						+ " P_LEVELS=" + quote(levels)
						+ " P_SECTION=" + quote(section)
						+ " P_LVL_SEQ=" + quote(lvl_seq)
						+ " P_MENU_NM=" + quote(menu_nm)
						+ " P_PAGE_URL=" + quote(page_url)
						+ " P_ETC=" + quote(etc)
						+ " P_MANAGER=" + quote(manager)
						+ " P_JOIN_DATE=" + quote(join_date)
						+ " P_DEPT_NM=" + quote(dept_nm)
						+ " P_IMAGE_LEVEL=" + quote(image_level)
						+ " P_FILE_NAME=" + quote(file_name)
						;
		/* 
		argument    	= " _sqlName=TST001V.insertTestTableData2"
						;	
											*/
	}
	// 수정 (Update)
	else{
		argument    	= " _sqlName=TST001V.updateTestTableData"
						+ " P_ID=" + quote(id)
						+ " P_LEVELS=" + quote(levels)
						+ " P_SECTION=" + quote(section)
						+ " P_LVL_SEQ=" + quote(lvl_seq)
						+ " P_MENU_NM=" + quote(menu_nm)
						+ " P_PAGE_URL=" + quote(page_url)
						+ " P_ETC=" + quote(etc)
						+ " P_MANAGER=" + quote(manager)
						+ " P_JOIN_DATE=" + quote(join_date)
						+ " P_DEPT_NM=" + quote(dept_nm)
						+ " P_IMAGE_LEVEL=" + quote(image_level)
						;
	}		
	
	var callbackFunc 	= "";
	
	if(flag == 'last'){
		callbackFunc    = "fn_save_callback";
	}
	
	transaction(svcID, url, inDatasets, outDatasets, argument, callbackFunc);
}


/* 저장이나 수정이 완료되고 난 후에 진행바를 화면에서 없에고 자동으로 조회를 시킨다 */
function fn_save_callback()
{
	gfn_showProgressWindow(false);
	btn_search_OnClick();
}


/* 헤더에서 체크박스를 선택할 경우에 전부 선택이 되게 한다. */
function Grid1_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
{
	// 체크박스 클릭시
	if(nCell == 0){
		
		//gfn_SetCheckBoxAllSelected(nCell, Grid1, ds_test_data, "checked");
		
		gfn_procGridMultiSort(obj, ds_test_data, nCell, "");
		
	}else if(nCell == 1){
		//아무 동작도 없다.
	}else{
		gfn_GridSort(Grid1, ds_test_data, nCell);
	}	
}


/* 행추가 함수 */
function btn_add_row_OnClick(obj)
{
	gfn_AddColumn(ds_test_data, 'checked');
}


/* 행삭제 함수 */
function btn_del_row_OnClick(obj)
{
	if((ds_test_data.rowcount < 1) || (!confirm('정말로 삭제하시겠습니까?'))){
		return;
	}
	
	Grid1.SetCellProp("head", 0, "Text", 0); //삭제하면 자동조회를 하므로 헤더의 체크박스를 해제한다.
	
	
	for(var nRow=0;nRow<ds_test_data.count; nRow++)
	{
		if(ds_test_data.GetColumn(nRow,"checked")=="1"){ // checked 컬럼 1 셋팅
			ds_test_data.SetColumn(nRow,"Flag","D"); // FLAG = D 셋팅
		}
	}
	
	ds_test_data.Filter("checked=='0'");
	//ds_test_data.Filter("Flag=='N'");	// FLAG=N 인 레코드만 그리드에 보여준다. (조회시 DB에서 FLAG 값 defalut로 'N' 삽입)
	Grid1.Redraw;
	
}


/* 그리드와 디비에서 리스트를 삭제한다. */
function deleteTestData(id,delCnt)
{
	ds_test_data.DeleteRow(delCnt); //그리드에서 리스트에서 삭제한다.

	var svcID			= "TST001V.testFunctionDelete";
	var url   			= "service::TST001V.testFunctionDelete.do";
	var inDatasets      = "";
	var outDatasets 	= "";
	var argument    	= " _sqlName=TST001V.deleteTestTableData"
						+ " P_ID=" + quote(id)
						;
	var callbackFunc 	= "";

	if(ParseInt(id) > 68){
		//새로 추가 된 값은 삭제시킨다.
		transaction(svcID, url, inDatasets, outDatasets, argument, callbackFunc);
	}else{
		//새로 추가된 값 이외의 본레의 값은 디비에서 삭제 시키지 않는다.
		//transaction(svcID, url, inDatasets, outDatasets, argument, callbackFunc);
	}
}


/* 엑셀 다운로드 */
function btn_print_OnClick(obj)
{
	gfn_SaveExcelContents(FileDialog0, Grid1, "C:\\", "TestExcel_"+gfn_GetNowDateTime(), "테스트 보고서", true);
}


/* 초기화*/
function Button5_OnClick(obj)
{
	big_section = ""; 
	small_seq   = ""; 

	ds_test_data.ClearData();
	
	cob_big_menu.Index  = 0;
	ds_small_menu.ClearData();
	gfn_AddComboData(0, ds_small_menu, "id", "0", "menu_nm", "[전체]");
	cob_small_menu.Index = 0;	
}


function Grid1_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	//alert(ds_test_data.GetColumn(nRow,"page_url")+', ' +ds_test_data.GetColumn(nRow,"image_level")+', ' +ds_test_data.GetColumn(nRow,"flag"));
}


/* 엑셀 업로드*/
function Button29_OnClick(obj)
{
	ds_test_data.ClearData();
	ds_tmp_test_data.ClearData();
	gfn_loadExcelFile(ds_tmp_test_data, true);
	
	// 엑셀에서 업로드하면 데이터셋에 차래대로 들어가므로 아래와 같이  
	// 그리드의 컬럼에 직접 넣어줄 수도 있고 처음부터 데이터셋을 맟춰 줄 수도 있다.
	for(var i=0;i<ds_tmp_test_data.rowcount;i++)
	{
		ds_test_data.InsertRow(i); //로우를 추가해준다.
	
		//trace("********* levels");
		//trace(ds_tmp_test_data.GetColumn(i,"page_url"));
		ds_test_data.SetColumn(i,"levels",ds_tmp_test_data.GetColumn(i,"page_url"));
		
		//trace("********* section");
		//trace(ds_tmp_test_data.GetColumn(i,"etc"));
		ds_test_data.SetColumn(i,"section",ds_tmp_test_data.GetColumn(i,"etc"));
		
		//trace("********* lvl_seq");
		//trace(ds_tmp_test_data.GetColumn(i,"index"));
		ds_test_data.SetColumn(i,"lvl_seq",ds_tmp_test_data.GetColumn(i,"index"));
		
		//trace("********* menu_nm");
		//trace(ds_tmp_test_data.GetColumn(i,"checked"));
		ds_test_data.SetColumn(i,"menu_nm",ds_tmp_test_data.GetColumn(i,"checked"));
		
		//trace("********* manager");
		//trace(ds_tmp_test_data.GetColumn(i,"manager"));
		ds_test_data.SetColumn(i,"manager",ds_tmp_test_data.GetColumn(i,"manager"));
		
		//trace("********* dept_nm");
		//trace(ds_tmp_test_data.GetColumn(i,"join_date"));
		ds_test_data.SetColumn(i,"dept_nm",ds_tmp_test_data.GetColumn(i,"join_date"));
		
		//trace("********* join_date");
		//trace(ds_tmp_test_data.GetColumn(i,"dept_nm"));
		ds_test_data.SetColumn(i,"join_date",ds_tmp_test_data.GetColumn(i,"dept_nm"));
		
	}	
}

function Grid1_OnRButtonDown(obj,nPosX,nPosY,nRow,nCell,nPivotIndex)
{
	if(nRow == -1){
		// 동작이 없다.
	}else{
		gfn_Grid_Multi_Sort(obj,false,5);
	} 
}



]]></Script>
</Window>